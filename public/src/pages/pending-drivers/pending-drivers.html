<html><head><link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html"><link rel="import" href="../../../bower_components/paper-tooltip/paper-tooltip.html"><link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../../bower_components/paper-card/paper-card.html"><link rel="import" href="../../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html"><link rel="import" href="../../../bower_components/paper-item/paper-item.html"><link rel="import" href="../../../bower_components/iron-list/iron-list.html"><link rel="import" href="../../../bower_components/paper-radio-button/paper-radio-button.html"><link rel="import" href="../../../bower_components/paper-radio-group/paper-radio-group.html"><link rel="import" href="../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html"><link rel="import" href="../../../bower_components/paper-item/paper-item-body.html"><link rel="import" href="../../../bower_components/neon-animation/web-animations.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable-card.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable-column.html"><link rel="import" href="../../../bower_components/paper-money-input-ench/paper-money-input-ench.html"><link rel="import" href="../../../bower_components/neon-animation/web-animations.html"><link rel="import" href="../../../bower_components/polymer/lib/elements/dom-if.html"><link rel="import" href="../../elements/my-icons.html"><link rel="import" href="../../elements/base-class.html"></head><body><dom-module id="page-pending-drivers"><template><style include="iron-flex iron-flex-alignment">:host{display:block;}#dataTableCard{padding:10px;}paper-item{--paper-item:{cursor:pointer;};}paper-button.document-action{color:var(--primary-color);}</style><paper-dialog id="dlgApproval" style="max-width:1000px ;min-height:300px;" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>{{localize('title-approval-driver')}}<span>{{item.id}}</span></h2><paper-dialog-scrollable><iron-form id="formEdit" on-iron-form-submit="onSubmitDriver"><form><div class="vertical layout"><paper-input type="number" name="id" value="[[item.id]]" label="[[localize('column-id')]]" readonly="" hidden=""></paper-input><div class="horizontal layout"><paper-input type="text" name="first_name" value="[[item.first_name]]" label="{{localize('column-first-name')}}" class="flex"></paper-input><paper-input type="text" name="last_name" value="[[item.last_name]]" label="{{localize('column-last-name')}}" class="flex"></paper-input></div><div class="horizontal layout"><paper-input type="number" name="mobile_number" value="[[item.mobile_number]]" label="{{localize('column-mobile-number')}}" class="flex"></paper-input><paper-input type="text" name="certificate_number" value="[[item.certificate_number]]" label="{{localize('column-certificate-number')}}" class="flex"></paper-input></div><div class="horizontal layout"><input type="hidden" name="gender" value="{{selectedGender}}"><paper-dropdown-menu label="[[localize('column-gender')]]"><paper-listbox slot="dropdown-content" attr-for-selected="value" selected="{{selectedGender}}"><paper-item value="unknown">[[localize('gender-unknown')]]</paper-item><paper-item value="male">[[localize('gender-male')]]</paper-item><paper-item value="female">[[localize('gender-female')]]</paper-item></paper-listbox></paper-dropdown-menu><paper-dropdown-menu label="{{localize('column-car-name')}}" class="flex"><paper-listbox slot="dropdown-content" selected="{{selectedCar}}" attr-for-selected="value"><template is="dom-repeat" items="[[cars]]" as="car"><paper-item value="[[car.id]]">[[car.title]]</paper-item></template></paper-listbox></paper-dropdown-menu><input name="car_id" type="hidden" value="{{selectedCar}}"><paper-input name="car_color" value="[[item.car_color]]" label="{{localize('column-car-color')}}" class="flex"></paper-input><paper-input type="number" name="car_production_year" value="[[item.car_production_year]]" label="{{localize('column-car-prod-year')}}" class="flex"></paper-input></div><div class="horizontal layout"><paper-input name="car_plate" value="{{item.car_plate}}" label="{{localize('column-car-plate')}}" class="flex"></paper-input><paper-input name="account_number" value="{{item.account_number}}" label="{{localize('column-account-number')}}" class="flex"></paper-input></div><div class="horizontal layout"><paper-input name="address" value="{{item.address}}" label="{{localize('column-address')}}" class="flex"></paper-input></div><h5>[[localize('documents-driver-submitted')]]</h5><iron-list style="height: 100px; width: 100%" grid="" items="[[documents]]"><template><a href="[[getImageAddressFromMedia(item)]]" target="_blank"><iron-image sizing="contain" width="100" height="100" src="[[getImageAddressFromMedia(item)]]"></iron-image></a></template></iron-list><h5>[[localize('select-driver-services')]]</h5><paper-listbox selected-values="{{enabledServices}}" attr-for-selected="value" style="overflow-y: scroll;" multi=""><template is="dom-repeat" items="{{services}}"><paper-item value="[[item.id]]" role="menuitemcheckbox"><iron-image sizing="contain" style="margin-right: 16px" preload="" width="80" height="50" src="[[getImageAddressFromMedia(item.media)]]"></iron-image><paper-item-body two-line="" disabled=""><div>[[item.title]]</div><div secondary="">Base Fare: [[item.base_fare]] Per 100m: [[item.per_hundred_meters]]</div></paper-item-body></paper-item></template></paper-listbox><paper-radio-group selected="{{item.status}}"><paper-radio-button name="offline">Approve</paper-radio-button><paper-radio-button name="soft reject">Soft Reject</paper-radio-button><paper-radio-button name="hard reject">Hard Reject</paper-radio-button></paper-radio-group><template is="dom-if" if="[[_isEqualTo(item.status,'soft reject')]]"><paper-input label="Note to user" value="{{item.documents_note}}"></paper-input></template></div></form></iron-form></paper-dialog-scrollable><div class="buttons"><paper-button dialog-dismiss="">{{localize('dismiss')}}</paper-button><paper-button dialog-confirm="" autofocus="" on-click="onConfirmEditClicked">{{localize('confirm')}}</paper-button></div></paper-dialog><paper-datatable-card id="dataTableCard" header="{{localize('pending-drivers')}}" data-source="{{data}}" page-size="10" id-property="id"><div slot="toolbar-main"><paper-input value="{{searchTerm}}" on-input="refreshList" label="{{localize('table-search')}}" style="display:inline-block" no-label-float=""><div slot="prefix"><iron-icon icon="my-icons:search"></iron-icon></div></paper-input><paper-icon-button icon="cached" on-tap="refreshList"></paper-icon-button></div><div slot="toolbar-select"></div><div slot="toolbar-select-single"><paper-icon-button id="btnEdit" icon="my-icons:drawer-pending-drivers" on-tap="onApprovalForm"></paper-icon-button><paper-tooltip for="btnEdit">{{localize('review-request')}}</paper-tooltip></div><paper-datatable id="datatable" selectable="" selected-item="{{item}}" on-row-tap="rowTapped"><div slot="no-results">{{localize('table-loading')}}</div><paper-datatable-column header="{{localize('column-id')}}" property="id" align="center"></paper-datatable-column><paper-datatable-column header="{{localize('column-first-name')}}" property="first_name"></paper-datatable-column><paper-datatable-column header="{{localize('column-last-name')}}" property="last_name"></paper-datatable-column><paper-datatable-column header="{{localize('column-certificate-number')}}" property="certificate_number"></paper-datatable-column><paper-datatable-column header="{{localize('column-mobile-number')}}" property="mobile_number"></paper-datatable-column><paper-datatable-column header="{{localize('column-car-plate')}}" property="car_plate"></paper-datatable-column><paper-datatable-column header="{{localize('column-car-name')}}" property="car_title"></paper-datatable-column></paper-datatable></paper-datatable-card></template><script>let pendingDriversPage;class PagePendingDrivers extends BaseClass{static get is(){return"page-pending-drivers"}static get properties(){return{data:{type:Object,value:{get:function(sort,page,pageSize){return app.getRows(pendingDriversPage,"driver",{status:"pending approval"},sort,page,pageSize,["mobile_number","first_name","last_name"],pendingDriversPage.searchTerm)},set:function(item,property,value){return app.setColumnValue("driver",item.id,property,value)},length:0}},cars:Array,services:Array,documents:Array,reviews:Array,selectedStatus:{type:String,value:"",observer:"_selectedStatusChanged"},item:Object,transactions:Array,operatorId:Number,enabledServices:{type:Array,notify:!0/* ignoreName */ /* skipSlots */},searchTerm:String,selectedAction:String}}_isEqualTo(title,string){return title===string}_serviceEnabled(services,service){if(services==void 0)return(/* ignoreName */!1/* skipSlots */ /* skipSlots */);return services.includes(service)}onApprovalForm(){this.selectedCar=this.item.car_id;this.selectedGender=this.item.gender;this.refreshChilds();this.getRows(this,"driver_document",{driver_id:this.item.id},{property:"id",direction:"asc"},1,100,[],"").then(result=>{this.set("documents",result.map(x=>x.media))});this.getRows(this,"driver_service",{driver_id:this.item.id},{property:"id",direction:"asc"},1,100,[],"").then(function(result){let mapped=result.map(x=>x.service_id);this.set("enabledServices",mapped);this.$.dlgApproval.open()}.bind(this))}onConfirmEditClicked(){this.$.formEdit.submit()}onSubmitDriver(event){if(event.detail.offline){delete event.detail.offline;event.detail.status="offline"}if(event.detail["soft reject"]){delete event.detail["soft reject"];event.detail.status="soft reject"}if(event.detail["hard reject"]){delete event.detail["hard reject"];event.detail.status="hard reject"}this.saveRow("driver",event.detail).then(function(result){this.$.dataTableCard.retrieveVisibleData();this.$.dataTableCard.deselectAll();this.deleteRowsCustom("driver_service",{driver_id:null!=this.item?this.item.id:""}).then(function(result){for(let enabledService of this.enabledServices)this.saveRow("driver_service",{driver_id:null!=this.item?this.item.id:result,service_id:enabledService})}.bind(this))}.bind(this))}rowTapped(ev){if(this.isDebouncerActive("dblclick"+ev.detail.item.id)){ev.preventDefault();this.$.dataTableCard.deselectAll();this.$.dataTableCard.select(ev.detail.item.id);this.onEditItem();this.cancelDebouncer("dblclick")}else{this.debounce("dblclick"+ev.detail.item.id,function(){},300)}}refreshList(ev){this.$.dataTableCard.retrieveVisibleData()}attached(){super.attached();pendingDriversPage=this}refreshChilds(){this.getRows(this,"car",{},{property:"id",direction:"asc"},1,100,[],"").then(function(result){this.set("cars",result)}.bind(this));this.getRows(this,"service",{},{property:"id",direction:"asc"},1,100,[],"").then(function(result){this.set("services",result)}.bind(this))}onViewDocumentClicked(event){window.open(this.getMediaPath(event.model.item),"_blank")}onDeleteDcoumentClicked(event){this.deleteRows("driver_document",[event.model.item.id]).then(result=>{})}}customElements.define(PagePendingDrivers.is,PagePendingDrivers);</script></dom-module></body></html>