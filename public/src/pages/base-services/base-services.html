<html><head><link rel="import" href="../../../bower_components/paper-tooltip/paper-tooltip.html"><link rel="import" href="../../../bower_components/paper-tabs/paper-tabs.html"><link rel="import" href="../../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../../bower_components/iron-image/iron-image.html"><link rel="import" href="../../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html"><link rel="import" href="../../../bower_components/paper-money-input-ench/paper-money-input-ench.html"><link rel="import" href="../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../../../bower_components/paper-tabs/paper-tab.html"><link rel="import" href="../../../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../../../bower_components/paper-item/paper-item.html"><link rel="import" href="../../../bower_components/paper-item/paper-item-body.html"><link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable-card.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable-column.html"><link rel="import" href="../../../bower_components/neon-animation/web-animations.html"><link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../../elements/dialog-media.html"><link rel="import" href="../../elements/base-class.html"><script type="text/javascript" src="../../../languages.js"></script></head><body><dom-module id="page-base-services"><template><style include="iron-flex iron-flex-alignment">:host{display:block;padding:10px;}paper-tabs{background-color:var(--primary-color);color:white;--paper-tabs-selection-bar-color:var(--accent-color);padding-left:0;}.input-service{width:100%;}.checkbox-option{margin:4px;margin-left:0;}</style><paper-dialog id="dlgCategory" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>[[localize('edit-service-category')]]</h2><iron-form id="formCategory" on-iron-form-submit="onSubmitCategory"><form><paper-input type="text" label="[[localize('column-id')]]" name="id" value="[[selectedCategory]]" readonly=""></paper-input><paper-input type="text" label="[[localize('column-title')]]" name="title" value="" required=""></paper-input></form></iron-form><div class="buttons"><paper-button dialog-dismiss="">{{localize('dismiss')}}</paper-button><paper-button autofocus="" on-click="onSaveCategoryClicked">{{localize('save')}}</paper-button></div></paper-dialog><paper-dialog id="dlgService" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2 id="headerServiceDialog">[[localize('edit-service')]]</h2><div class="layout horizontal"><div class="layout vertical"><iron-form id="formService" on-iron-form-submit="onSubmitService"><form class="layout vertical"><div class="layout horizontal"><paper-input type="text" class="input-service" label="[[localize('column-id')]]" name="id" value="[[selectedService.id]]" readonly=""></paper-input><paper-input type="text" class="input-service" label="[[localize('column-title')]]" name="title" value="[[selectedService.title]]" required=""></paper-input></div><div class="layout horizontal"><paper-money-input-ench type="number" label="[[localize('column-base-fare')]]" name="base_fare" value="[[selectedService.base_fare]]" currency="[[cur.symbol]]" precision="[[cur.precision]]" unit-symbol="[[cur.unit_symbol]]"></paper-money-input-ench><paper-money-input-ench type="number" label="[[localize('column-per-hundred-meters')]]" name="per_hundred_meters" value="[[selectedService.per_hundred_meters]]" currency="[[cur.symbol]]" precision="[[cur.precision]]" unit-symbol="[[cur.unit_symbol]]"></paper-money-input-ench></div><div class="layout horizontal"><paper-money-input-ench type="number" label="[[localize('column-per-minute-wait')]]" name="per_minute_wait" value="[[selectedService.per_minute_wait]]" currency="[[cur.symbol]]" precision="[[cur.precision]]" unit-symbol="[[cur.unit_symbol]]"></paper-money-input-ench><paper-money-input-ench type="number" label="[[localize('column-per-minute-passed')]]" name="per_minute_passed" value="[[selectedService.per_minute_passed]]" currency="[[cur.symbol]]" precision="[[cur.precision]]" unit-symbol="[[cur.unit_symbol]]"></paper-money-input-ench></div><div class="layout horizontal"><paper-input type="time" class="input-service" label="[[localize('column-available-time-from')]]" name="available_time_from" value="[[selectedService.available_time_from]]" required=""></paper-input><paper-input type="time" class="input-service" label="[[localize('column-available-time-to')]]" name="available_time_to" value="[[selectedService.available_time_to]]" required=""></paper-input></div><div class="layout horizontal"><paper-input type="number" class="input-service" label="[[localize('column-provider-share-percent')]]" name="provider_share_percent" value="[[selectedService.provider_share_percent]]" required=""></paper-input><paper-money-input-ench type="number" class="input-service" label="[[localize('column-provider-share-flat')]]" name="provider_share_flat" value="[[selectedService.provider_share_flat]]" currency="[[cur.symbol]]" precision="[[cur.precision]]" unit-symbol="[[cur.unit_symbol]]"></paper-money-input-ench></div><paper-checkbox class="checkbox-option" name="can_use_confirmation_code" checked="[[selectedService.can_use_confirmation_code]]">Can use confirmation code</paper-checkbox><paper-checkbox class="checkbox-option" name="should_estimate_fee" checked="[[selectedService.should_estimate_fee]]">Should estimate fee?</paper-checkbox><paper-checkbox class="checkbox-option" name="keep_estimated_fee" checked="[[selectedService.keep_estimated_fee]]">Static fee (Based on estimation)</paper-checkbox><input type="hidden" name="media_id" value="{{selectedMedia}}"> <input type="hidden" name="service_category_id" value="[[selectedCategory]]"></form></iron-form><iron-image id="imagePreview" style="width:100%; height:100px;" placeholder="[[selectedService.media.base64]]" sizing="contain" preload="" src="[[getImageAddressFromMedia(selectedService.media)]]"></iron-image><paper-button style="width: 100%; color:var(--primary-color);" on-click="onSelectImageClicked">[[localize('button-select-media')]]</paper-button><dialog-media id="dlgMedia" selected-id="{{selectedMedia}}" selected-category="service" force-category="" on-selected="onSelectedMedia"></dialog-media></div><div class="vertical layout" style="width: 300px; height: 230px;"><h5>[[localize('select-service-regions')]]</h5><paper-listbox selected-values="{{enabledRegions}}" attr-for-selected="value" style="overflow-y: scroll;" multi=""><template is="dom-repeat" items="{{regions}}"><paper-item value="[[item.id]]" role="menuitemcheckbox"><paper-item-body><div>[[item.name]]</div></paper-item-body></paper-item></template></paper-listbox></div></div><div class="buttons"><paper-button dialog-dismiss="">[[localize('dismiss')]]</paper-button><paper-button autofocus="" on-click="onSaveServiceClicked">[[localize('save')]]</paper-button></div></paper-dialog><paper-tabs scrollable="" attr-for-selected="name" selected="{{selectedCategory}}"><template is="dom-repeat" items="{{categories}}"><paper-tab name="[[item.id]]">[[item.title]]</paper-tab></template><paper-button on-click="onAddCategoryClicked">[[localize('button-add-category')]]</paper-button><paper-button on-click="onEditCategoryClicked">[[localize('button-edit-category')]]</paper-button><paper-button on-click="onDeleteCategoryClicked">[[localize('button-delete-category')]]</paper-button></paper-tabs><paper-datatable-card id="dataTableCard" header="{{localize('services')}}" data-source="{{data}}" page-size="10" id-property="id" selected-ids="{{selectedIds}}"><div slot="toolbar-main"><paper-input id="searchInput" value="{{searchTerm}}" label="{{localize('table-search')}}" on-input="refreshTable" style="display:inline-block"><div slot="prefix"><iron-icon icon="search"></iron-icon></div></paper-input><paper-icon-button icon="cached" on-tap="refreshTable"></paper-icon-button><paper-icon-button icon="add" on-click="onAddServiceClicked"></paper-icon-button></div><div slot="toolbar-select"><paper-icon-button icon="delete" on-click="onDeleteServiceClicked"></paper-icon-button></div><div slot="toolbar-select-single"><paper-icon-button icon="my-icons:edit" on-tap="onEditItemClicked"></paper-icon-button></div><paper-datatable id="datatable" selectable="" selected-item="{{selectedService}}"><div slot="no-results">[[localize('table-loading')]]</div><paper-datatable-column header="{{localize('column-id')}}" property="id" type="Number"></paper-datatable-column><paper-datatable-column header="[[localize('column-image')]]" property="media"><template><iron-image sizing="contain" preload="" width="80" height="50" src="[[getImageAddressFromMedia(value)]]"></iron-image></template></paper-datatable-column><paper-datatable-column header="{{localize('column-title')}}" property="title" type="String"></paper-datatable-column><paper-datatable-column header="{{localize('column-base-fare')}}" property="base_fare" type="Number" format-value="{{moneyFormatter}}"></paper-datatable-column><paper-datatable-column header="{{localize('column-per-hundred-meters')}}" property="per_hundred_meters" type="String" format-value="{{moneyFormatter}}"></paper-datatable-column><paper-datatable-column header="{{localize('column-per-minute-wait')}}" property="per_minute_wait" type="String" format-value="{{moneyFormatter}}"></paper-datatable-column><paper-datatable-column header="{{localize('column-per-minute-passed')}}" property="per_minute_passed" type="String" format-value="{{moneyFormatter}}"></paper-datatable-column><paper-datatable-column header="{{localize('column-available-time-from')}}" property="available_time_from" type="String"></paper-datatable-column><paper-datatable-column header="{{localize('column-available-time-to')}}" property="available_time_to" type="String"></paper-datatable-column></paper-datatable></paper-datatable-card></template><script>let baseServicesPage;class PageBaseServices extends BaseClass{static get is(){return"page-base-services"}static get properties(){return{data:{type:Object,value:{get:function(sort,page,pageSize){return app.getRows(baseServicesPage,"service",{service_category_id:baseServicesPage.selectedCategory},sort,page,pageSize,["title"],baseServicesPage.searchTerm)},set:function(item,property,value){return null},length:0}},searchTerm:String,categories:Array,selectedId:Number,selectedCategory:{type:Number,observer:"onCategoryCanged",value:0},selectedService:Object,selectedMedia:Number,selectedIds:Array,cur:{value:function(){return currency}},regions:{type:Array,value:[]},enabledRegions:{type:Array,value:[]}}}attached(){super.attached();baseServicesPage=this;this.reloadCategories()}onCategoryCanged(){this.$.dataTableCard.retrieveVisibleData()}reloadCategories(){baseServicesPage.getRows(baseServicesPage,"service_category",{},{property:"id",direction:"asc"},1,100,[],"").then(function(result){baseServicesPage.categories=result;baseServicesPage.selectedCategory=result[0].id})}onDeleteCategoryClicked(){if(this.haveAccess("service","delete")){this.deleteRows("service_category",[this.selectedCategory]).then(function(rowsAffected){baseServicesPage.reloadCategories()}.bind(this))}else{app.showErrorMessage("Permission for deleting services is not granted for this user.")}}onDeleteServiceClicked(){this.deleteRows("service",this.selectedIds).then(function(rowsAffected){this.$.dataTableCard.retrieveVisibleData()}.bind(this))}onAddServiceClicked(){if(0===this.selectedCategory){app.showErrorMessage(this.localize("error-no-category-selected"));return}this.refreshRegions();this.set("selectedService",{should_estimate_fee:!0/* ignoreName */ /* skipSlots */,keep_estimated_fee:!0,base_fare:0,per_hundred_meters:0,per_minute_wait:0,per_minute_passed:0,provider_share_percent:0,provider_share_flat:0});this.set("enabledRegions",[]);this.selectedMedia=null;this.$.imagePreview.src="";this.$.dlgService.open()}onAddCategoryClicked(){if(this.haveAccess("service","update")){this.$.formCategory.reset();this.$.dlgCategory.open()}else{app.showErrorMessage("Permission to edit services is not enabled for this user.")}}onSaveCategoryClicked(){this.$.formCategory.submit()}onSubmitCategory(event){baseServicesPage.saveRow("service_category",event.detail).then(function(result){baseServicesPage.reloadCategories();baseServicesPage.$.dlgCategory.close()})}onSaveServiceClicked(){this.$.formService.submit()}onSubmitService(event){var _this=this;return babelHelpers.asyncToGenerator(function*(){event.detail.keep_estimated_fee="on"==event.detail.keep_estimated_fee;event.detail.should_estimate_fee="on"==event.detail.should_estimate_fee;event.detail.can_use_confirmation_code="on"==event.detail.can_use_confirmation_code;let result=yield baseServicesPage.saveRow("service",event.detail);if(null!=_this.selectedService){yield _this.deleteRowsCustom("service_region",{service_id:_this.selectedService.id})}for(let enabledRegion of _this.enabledRegions)yield _this.saveRow("service_region",{service_id:null!=_this.selectedService?_this.selectedService.id:result,region_id:enabledRegion});baseServicesPage.$.dlgService.close();baseServicesPage.$.dataTableCard.retrieveVisibleData()})()}onEditCategoryClicked(){if(this.haveAccess("service","update")){this.$.dlgCategory.open()}else{app.showErrorMessage("Permission to edit services is not enabled for this user.")}}onEditItemClicked(){this.refreshRegions();this.selectedMedia=this.selectedService.media_id;this.setImageFromMedia(this.$.imagePreview,this.selectedService.media_id);this.getRows(this,"service_region",{service_id:this.selectedService.id},{property:"id",direction:"asc"},1,100,[],"").then(function(result){let mapped=result.map(x=>x.region_id);this.set("enabledRegions",mapped);this.$.dlgService.open()}.bind(this))}refreshRegions(){this.getRows(this,"region",{},{property:"id",direction:"asc"},1,100,[],"").then(function(result){this.set("regions",result)}.bind(this))}onSelectImageClicked(){this.$.dlgMedia.show();this.$.dlgMedia.selectedId=this.selectedService.media_id}onSelectedMedia(event){this.set("selectedMedia",event.detail.selectedId);this.setImageFromMedia(this.$.imagePreview,event.detail.selectedId)}}customElements.define(PageBaseServices.is,PageBaseServices);</script></dom-module></body></html>