<html><head><link rel="import" href="../../../bower_components/paper-tooltip/paper-tooltip.html"><link rel="import" href="../../../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../../bower_components/iron-image/iron-image.html"><link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable-card.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable-column.html"><link rel="import" href="../../../bower_components/neon-animation/web-animations.html"><link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../../../bower_components/google-map/google-map.html"><link rel="import" href="../../../bower_components/google-map/google-map-search.html"><link rel="import" href="../../../bower_components/google-map/google-map-poly.html"><link rel="import" href="../../elements/base-class.html"></head><body><dom-module id="page-base-regions"><template><style>:host{display:block;padding:10px;}#map{width:500px;height:430px;}</style><paper-dialog id="dlgEdit" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2 id="headerDialog">Edit Region</h2><iron-form id="formItem" on-iron-form-submit="onSubmit"><form class="layout vertical"><paper-input type="text" class="input-service" label="[[localize('column-id')]]" name="id" value="[[selected.id]]" readonly="" hidden=""></paper-input><paper-input label="Name" name="name" value="[[selected.name]]"></paper-input><google-map-search map="[[map]]" query="Pizza" results="{{results}}" width="100" height="50"></google-map-search><google-map id="map" map="{{map}}" api-key="[[apiKey]]" draggable="true" latitude="37.4219" longitude="-122.0862" zoom="15" click-events="" on-google-map-click="onMapClicked"><google-map-poly id="poly" closed="" fill-color="blue" fill-opacity=".5" editable="" draggable="" clickable=""><template is="dom-repeat" items="{{points}}"><google-map-point latitude="[[item.lat]]" longitude="[[item.lng]]"></google-map-point></template></google-map-poly></google-map><paper-button raised="" on-click="onDrawClicked" style="margin: 8px">Draw</paper-button><paper-button raised="" on-click="onClearMapClicked" style="margin: 8px">Clear</paper-button><paper-checkbox name="enabled" checked="[[selected.enabled]]" style="width: 100%">Enabled</paper-checkbox></form></iron-form><div class="buttons"><paper-button dialog-dismiss="">{{localize('dismiss')}}</paper-button><paper-button autofocus="" on-click="onSaveClicked">{{localize('save')}}</paper-button></div></paper-dialog><paper-datatable-card id="dataTableCard" header="{{localize('regions')}}" data-source="{{data}}" page-size="10" id-property="id" selected-ids="{{selectedIds}}"><div slot="toolbar-main"><paper-input id="searchInput" value="{{searchTerm}}" label="{{localize('table-search')}}" on-input="refreshTable" style="display:inline-block"><div slot="prefix"><iron-icon icon="search"></iron-icon></div></paper-input><paper-icon-button icon="cached" on-tap="refreshTable"></paper-icon-button><paper-icon-button icon="add" on-click="onAddClicked"></paper-icon-button></div><div slot="toolbar-select"><paper-icon-button icon="delete" on-click="onDeleteClicked"></paper-icon-button></div><div slot="toolbar-select-single"><paper-icon-button icon="my-icons:edit" on-tap="onEditClicked"></paper-icon-button></div><paper-datatable id="datatable" selectable="" selected-item="{{selected}}"><div slot="no-results">{{localize('table-loading')}}</div><paper-datatable-column header="{{localize('column-id')}}" property="id" type="String"></paper-datatable-column><paper-datatable-column header="{{localize('column-name')}}" property="name" type="String"></paper-datatable-column></paper-datatable></paper-datatable-card></template><script>let baseRegionsPage;class PageBaseRegions extends BaseClass{static get is(){return"page-base-regions"}static get properties(){return{data:{type:Object,value:{get:function(sort,page,pageSize){return app.getRows(baseRegionsPage,"region",{},sort,page,pageSize,[],"")},set:function(item,property,value){return null},length:0}},apiKey:{type:String,value:function(){return localStorage.getItem("map")}},results:Array,searchTerm:String,selected:Object,map:Object,isDrawing:{type:Boolean,value:/* ignoreName */ /* ignoreName */!1/* skipSlots */ /* skipSlots */},points:{type:Array,value:[]}}}attached(){super.attached();baseRegionsPage=this}onDrawClicked(event){this.isDrawing=!this.isDrawing;if(this.isDrawing)event.srcElement.innerHTML="Finish Draw";else event.srcElement.innerHTML="Draw"}onClearMapClicked(){this.points=[];this.notifySplices("points",this.points)}onMapClicked(event){if(this.isDrawing){let lat=event.detail.latLng.lat(),lng=event.detail.latLng.lng();this.points.push({lat,lng});this.notifySplices("points",this.points)}}onAddClicked(){this.$.dlgEdit.open();this.points=[];this.set("points",this.points);this.set("selected",{enabled:!0/* skipSlots */})}onDeleteClicked(){this.deleteRows("region",this.selectedIds).then(function(rowsAffected){this.$.dataTableCard.retrieveVisibleData()}.bind(this))}onEditClicked(){this.$.dlgEdit.open();if(0<this.selected.location.length&&1<this.selected.location[0].length){this.points=this.selected.location[0].map(i=>{return{lat:i.x,lng:i.y}})}else{this.points=[]}this.set("points",this.points)}onSaveClicked(){this.$.formItem.submit()}onSubmit(event){var _this=this;/*let lastItem = this.points[this.points.length - 1];
        if (lastItem.lat != this.points[0].lat || lastItem.lng != this.points[0].lng) {
          this.points.push(this.points[0])
        }*/let geojson={type:"Polygon",coordinates:[this.$.poly.path.j.map(x=>[x.lng(),x.lat()])]};geojson.coordinates[0].push(geojson.coordinates[0][0]);socket.emit("upsertRegion",{id:event.detail.id,name:event.detail.name,enabled:"on"==event.detail.enabled,location:geojson},/*#__PURE__*/function(){var _ref=babelHelpers.asyncToGenerator(function*(result){if(200==result){_this.$.dlgEdit.close();_this.$.dataTableCard.retrieveVisibleData()}else{app.showErrorMessageForId(result)}});return function(_x){return _ref.apply(this,arguments)}}())}}customElements.define(PageBaseRegions.is,PageBaseRegions);</script></dom-module></body></html>