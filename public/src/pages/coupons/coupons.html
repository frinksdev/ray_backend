<html><head><link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html"><link rel="import" href="../../../bower_components/paper-tooltip/paper-tooltip.html"><link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html"><link rel="import" href="../../../bower_components/paper-item/paper-item.html"><link rel="import" href="../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html"><link rel="import" href="../../../bower_components/paper-item/paper-item.html"><link rel="import" href="../../../bower_components/neon-animation/web-animations.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable-card.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable.html"><link rel="import" href="../../../bower_components/bwt-datatable/bwt-datatable-column.html"><link rel="import" href="../../../bower_components/paper-money-input-ench/paper-money-input-ench.html"><link rel="import" href="../../../bower_components/neon-animation/web-animations.html"><link rel="import" href="../../../bower_components/polymer/lib/elements/dom-if.html"><link rel="import" href="../../../bower_components/range-datepicker/range-datepicker.html"><link rel="import" href="../../elements/my-icons.html"><link rel="import" href="../../elements/base-class.html"></head><body><dom-module id="page-coupons"><template><style include="iron-flex iron-flex-alignment">:host{display:block;}#dataTableCard{padding:10px;}.review-card{margin:10px;}.review-text{line-height:50px;}paper-item{--paper-item:{cursor:pointer;};}paper-button.green{background:#8BC34A;color:white;height:30px;top:24px;}</style><paper-dialog id="dlgEditItem" style="min-height:300px;" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>Item Details</h2><paper-dialog-scrollable><iron-form id="formEdit" on-iron-form-submit="onSubmit"><form><div class="vertical layout"><paper-input type="number" name="id" value="[[item.id]]" label="[[localize('column-id')]]" readonly="" hidden=""></paper-input><div class="horizontal layout"><paper-input type="text" name="title" value="[[item.title]]" label="{{localize('column-title')}}" class="flex"></paper-input><paper-input type="text" name="code" value="[[item.code]]" label="{{localize('column-code')}}" class="flex"></paper-input></div><div class="horizontal layout"><paper-input type="text" name="description" value="[[item.description]]" label="{{localize('column-description')}}" class="flex"></paper-input></div><div class="horizontal layout"><paper-input type="number" name="many_users_can_use" value="[[item.many_users_can_use]]" label="{{localize('column-many-users-can-use')}}" class="flex"></paper-input><paper-input type="number" name="many_times_user_can_use" value="[[item.many_times_user_can_use]]" label="{{localize('column-many-times-users-can-use')}}" class="flex"></paper-input></div><div class="horizontal layout"><paper-input type="number" name="minimum_cost" value="[[item.minimum_cost]]" label="{{localize('column-minimum-cost')}}" class="flex"></paper-input><paper-input type="number" name="maximum_cost" value="[[item.maximum_cost]]" label="{{localize('column-maximum-cost')}}" class="flex"></paper-input></div><h4>Choose date range coupon is valid to be used in:</h4><div class="layout horizontal"><paper-input name="start_at" value="{{unixToTimestamp(selected_start_at)}}" hidden=""></paper-input><paper-input name="expiration_at" value="{{unixToTimestamp(selected_expiration_at)}}" hidden=""></paper-input><range-datepicker date-from="{{selected_start_at}}" date-to="{{selected_expiration_at}}"></range-datepicker></div><div class="horizontal layout"><paper-input type="number" name="discount_percent" value="[[item.discount_percent]]" label="{{localize('column-discount-percent')}}" class="flex"></paper-input><paper-input type="number" name="discount_flat" value="[[item.discount_flat]]" label="{{localize('column-discount-flat')}}" class="flex"></paper-input><paper-input type="number" name="credit_gift" value="[[item.credit_gift]]" label="{{localize('column-credit-gift')}}" class="flex"></paper-input></div><h4 style="margin-bottom: 0px;">Select Services which this coupon can be used with:</h4><div class="horizontal layout"><div class="vertical layout" style="width: 100%; height: 230px;"><paper-listbox selected-values="{{enabledServices}}" attr-for-selected="value" style="overflow-y: scroll;" multi=""><template is="dom-repeat" items="{{services}}"><paper-item value="[[item.id]]">[[item.title]]</paper-item></template></paper-listbox></div></div></div></form></iron-form></paper-dialog-scrollable><div class="buttons"><paper-button dialog-dismiss="">{{localize('dismiss')}}</paper-button><paper-button dialog-confirm="" autofocus="" on-click="onConfirmEditClicked">{{localize('confirm')}}</paper-button></div></paper-dialog><paper-datatable-card id="dataTableCard" header="{{localize('coupons')}}" data-source="{{data}}" page-size="10" id-property="id"><div slot="toolbar-main"><paper-input value="{{searchTerm}}" on-input="refreshList" label="{{localize('table-search')}}" style="display:inline-block" no-label-float=""><div slot="prefix"><iron-icon icon="my-icons:search"></iron-icon></div></paper-input><paper-icon-button icon="cached" on-tap="refreshList"></paper-icon-button><paper-icon-button id="btnAddItem" icon="my-icons:add" on-click="onAddItem">+</paper-icon-button><paper-tooltip for="btnAddItem">{{localize('add-item')}}</paper-tooltip></div><div slot="toolbar-select"></div><div slot="toolbar-select-single"><paper-icon-button id="btnEdit" icon="my-icons:edit" on-tap="onEditItem"></paper-icon-button><paper-tooltip for="btnEdit">{{localize('edit-item')}}</paper-tooltip></div><paper-datatable id="datatable" selectable="" selected-item="{{item}}" on-row-tap="rowTapped"><div slot="no-results">{{localize('table-loading')}}</div><paper-datatable-column header="{{localize('column-id')}}" property="id" sortable="" align="center" style="width: 10%" sorted=""></paper-datatable-column><paper-datatable-column header="{{localize('column-title')}}" property="title"></paper-datatable-column><paper-datatable-column header="{{localize('column-code')}}" property="code"></paper-datatable-column><paper-datatable-column header="{{localize('column-description')}}" property="description"></paper-datatable-column><paper-datatable-column header="{{localize('column-discount-percent')}}" property="discount_percent"></paper-datatable-column><paper-datatable-column header="{{localize('column-discount-flat')}}" property="discount_flat" format-value="{{moneyFormatter}}"></paper-datatable-column><paper-datatable-column header="{{localize('column-start-at')}}" property="start_at" type="String" format-value="{{timestampFormatter}}"></paper-datatable-column><paper-datatable-column header="{{localize('column-expiration-at')}}" property="expiration_at" type="String" format-value="{{timestampFormatter}}"></paper-datatable-column></paper-datatable></paper-datatable-card></template><script>let couponsPage;class PageCoupons extends BaseClass{static get is(){return"page-coupons"}static get properties(){return{data:{type:Object,value:{get:function(sort,page,pageSize){return app.getRows(couponsPage,"coupon",{status:couponsPage.selectedStatus},sort,page,pageSize,["code","title"],couponsPage.searchTerm)},set:function(item,property,value){return app.setColumnValue("coupon",item.id,property,value)},length:0}},services:Array,enabledService:Array,formatLatLng:{type:Function,value:function(){return function(value){let lat=value.lat.toFixed(6),lng=value.lng.toFixed(6);return lat+" | "+lng}}},selectedStatus:{type:String,value:"",observer:"_selectedStatusChanged"},item:Object}}onAddItem(){this.$.dlgEditItem.open();this.item={many_times_user_can_use:0,many_users_can_use:0,discount_flat:0,discount_percent:0,credit_gift:0,minimum_cost:0,maximum_cost:0}}_isEqualTo(title,string){return title===string}onEditItem(){this.getRows(this,"coupon_service",{coupon_id:this.item.id},{property:"id",direction:"asc"},1,100,[],"").then(function(result){let mapped=result.map(x=>x.service_id);this.set("enabledServices",mapped)}.bind(this));this.$.dlgEditItem.open()}onConfirmEditClicked(){this.$.formEdit.submit()}onSubmit(event){this.saveRow("coupon",event.detail).then(function(newCouponId){this.$.dataTableCard.retrieveVisibleData();this.deleteRowsCustom("coupon_service",{coupon_id:this.item.id!=void 0?this.item.id:""}).then(function(result){for(let enabledService of this.enabledServices)this.saveRow("coupon_service",{coupon_id:this.item.id!=void 0?this.item.id:newCouponId,service_id:enabledService})}.bind(this))}.bind(this))}rowTapped(ev){if(this.isDebouncerActive("dblclick"+ev.detail.item.id)){ev.preventDefault();this.$.dataTableCard.deselectAll();this.$.dataTableCard.select(ev.detail.item.id);this.onEditItem();this.cancelDebouncer("dblclick")}else{this.debounce("dblclick"+ev.detail.item.id,function(){},300)}}refreshList(ev){this.$.dataTableCard.retrieveVisibleData()}attached(){super.attached();couponsPage=this;this.getRows(this,"service",{},{property:"id",direction:"asc"},1,100,[],"").then(function(result){this.set("services",result)}.bind(this))}_selectedStatusChanged(){this.$.dataTableCard.retrieveVisibleData()}}customElements.define(PageCoupons.is,PageCoupons);</script></dom-module></body></html>