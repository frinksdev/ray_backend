<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../paper-input/paper-input.html"><link rel="import" href="../paper-input/paper-input-error.html"><link rel="import" href="../iron-form-element-behavior/iron-form-element-behavior.html"></head><body><dom-module id="paper-money-input-ench"><template><style is="custom-style">:host{display:block;}.prefix{padding-right:10px;@apply (--paper-money-input-ench-prefix);}paper-input{width:var(--paper-money-input-ench-width);}.suffix{@apply (--paper-money-input-ench-suffix);}</style><paper-input id="input" invalid="{{invalid}}" label="[[label]]" no-label-float="[[noLabelFloat]]" always-float-label="[[alwaysFloatLabel]]" required$="[[required]]" value="{{_formattedValue}}" name$="[[name]]" allowed-pattern="[0-9\.\,\-]" disabled$="[[disabled]]" readonly$="[[readonly]]" placeholder$="[[placeholder]]"><div slot="prefix" class="prefix">[[currency]]</div><div slot="suffix" class="suffix">[[suffix]]</div></paper-input></template><script>Polymer({is:"paper-money-input-ench",behaviors:[Polymer.IronFormElementBehavior],properties:{/** Internal var to store formatted number */_formattedValue:{type:String,value:void 0},/** Disable field */disabled:{type:Boolean,value:/* ignoreName */ /* ignoreName */!1/* skipSlots */ /* skipSlots */},/** Disable field */invalid:{type:Boolean,notify:!0/* skipSlots */,value:!1},/** Sets field as readonly */readonly:{type:Boolean,value:!1},/** Sets field as required */required:{type:Boolean,value:!1},/** Field name */name:{type:String,value:"amount"},/** Field label */label:{type:String,value:"Amount"},/** Disables the floating label */noLabelFloat:{type:Boolean,value:!1},// Always float the label
alwaysFloatLabel:{type:Boolean,value:!1},/** Presets field value notifies new values */value:{type:Number,notify:!0},/** Currency used as field prefix */currency:{type:String,value:"$"},/** The suffix symbol or string */suffix:{type:String,value:""},/** Max value accepted by field */maxValue:{type:Number,value:1e6},/** Min value accepted by field */minValue:{type:Number,value:0},/** Decimal precision -> Use "0" for integer amount */precision:{type:Number,value:2},/** Error message for values higher than min value */minValueErrorMessage:{type:String,value:"Value must be higher than"},/** Error message for values higher than max value */maxValueErrorMessage:{type:String,value:"Value must be lower than"},/** Symbol used to separate number blocks */unitSymbol:{type:String,value:","},/** Symbol used to separate decimal from integer part */decimalSymbol:{type:String,value:"."},/** Placeholder to fill the input field while blank **/placeholder:{type:String,value:""}},observers:["_setValue(_formattedValue)","_onValueChanged(_formattedValue)","_valueChange(value)"],ready:function(){this.renderElement()},/** You can use this to re-render the input */renderElement:function(){this.$.input.invalid=!1;if(this.value&&!this._formattedValue){this._valuePreProcessing()}this._setValue=function(f){if(this._formattedValue){var signal=this._getSignal(this._formattedValue),number=parseFloat(this._removeUI(this._formattedValue))/Math.pow(10,this.precision);this.set("value",signal+number.toFixed(this.precision))}}},/** Clean completely the input value, this method will set the value to undefined */clean:function(){this.value=void 0;this._formattedValue=""},_valuePreProcessing:function(){var signal=0<=(""+this.value).indexOf("-")?"-":"",multiplier=Math.pow(10,this.precision),value=this.value*multiplier/multiplier,fraction=value%1,decFraction=fraction*multiplier/multiplier,integer=void 0,completeNumber=void 0;if(0==decFraction&&0!=this.precision){completeNumber=signal+value+".00"}else{integer=+this.value-+decFraction;completeNumber=integer+decFraction;completeNumber=completeNumber+"";var respFraction=completeNumber.split(".");if(respFraction[1]){var respFractionLen=respFraction[1].length;if(respFractionLen>this.precision){completeNumber=(+completeNumber).toFixed(this.precision)}else{var oddOrEven=respFractionLen%2;if(0<oddOrEven){completeNumber=""+completeNumber+"0"}}}}this._formattedValue=completeNumber},_valueChange:function(){if((this.value||0===this.value||"0"===this.value)&&(this._formattedValue!=this.value||0===this.value||"0"===this.value)){this._valuePreProcessing()}},_setValue:function(){//stub
},_getDecimal:function(string){return string.match(new RegExp("(\\d{0,"+this.precision+"})$"))[0]},_parse:function(string){var dec=this._getDecimal(string),reg=new RegExp(dec+"$"),result=string.replace(reg,"");result=(1>=result.length?result:this._markAmount(result))+this.decimalSymbol+dec;return result},_markAmount:function(string){return string.replace(/(0*)(?=[^0]*)/,"").split(/(?=(?:...)*$)/).join(this.unitSymbol)},_onValueChanged:function(){this.validate();if(""===this._formattedValue||"0"===this._formattedValue&&0==this.precision){return}if(0==this.precision){this._formattedValue=this._markAmount(this._removeUI(this._formattedValue));return}var signal=0<=(""+this._formattedValue).indexOf("-")?"-":"";if(this._removeUI(this._formattedValue).length<this.precision+1){var dec=this._getDecimal(this._removeUI(this._formattedValue)),group,decNoZeros=dec.replace(/(0*)(?=[^0]*)/,"");//check if needs to add 0 in the end, beginning or both
group=dec.match(new RegExp("(0*)(?="+decNoZeros+")"));if(0<group.filter(function(e,i){if(0<e.length){return e}}).length){if(group[0].length+decNoZeros.length==this.precision){this._formattedValue=signal+"0"+this._getDecimal(this._formattedValue);return}else if(group[0].length+decNoZeros.length<this.precision){this._formattedValue=signal+group[0]+decNoZeros+Array(this.precision-(group[0].length+decNoZeros.length)+1).join("0");return}}else{this._formattedValue=signal+Array(this.precision+1-decNoZeros.length+1).join("0")+decNoZeros}return}this._formattedValue=signal+this._parse(this._removeUI(this._formattedValue))},_removeUI:function(string){return(""+string).replace(/[^\d]*/g,"")},_getSignal:function(value){return 0<=value.indexOf("-")?"-":""},_generateNecessarySizeOfZerosChar:function(existingSize){existingSize=existingSize||0;return Array(this.precision-Math.abs(existingSize)+1).join("0")},_validate:function(value){var signal=0<=(""+value).indexOf("-")?"-":"",n=parseFloat(signal+this._removeUI(value))/Math.pow(10,this.precision);if(n>this.maxValue){this.$.input.invalid=!0;this.$.input.errorMessage=this.maxValueErrorMessage+" "+this.maxValue;return!1}else if(n<this.minValue){this.$.input.invalid=!0;this.$.input.errorMessage=this.minValueErrorMessage+" "+this.minValue;return!1}else{this.$.input.invalid=!1;this.$.input.errorMessage="";return!0}},/** Return validation based on required, max and min configs */validate:function(){return this.$.input.validate()&&this._validate(this.$.input.value)}});</script></dom-module></body></html>